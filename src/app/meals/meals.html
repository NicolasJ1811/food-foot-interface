<button class="fab" (click)="openAddForm()" title="Ajouter un nouveau repas">
  +
</button>

<div *ngIf="showAddForm" class="modal-overlay" (click)="closeAddForm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>{{ isEditing ? 'Modifier le repas' : 'Ajouter un nouveau repas' }}</h2>
    <form (ngSubmit)="saveMeal()" #mealForm="ngForm">
      <div class="form-group">
        <label for="name">Nom du repas</label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          [(ngModel)]="newMeal.name" 
          required
          placeholder="Ex: ≈íuf dur"
        />
      </div>

      <div class="form-group">
        <label for="type">Type de repas</label>
        <select id="type" name="type" [(ngModel)]="newMeal.type" required>
          <option value="Breakfast">Petit-d√©jeuner</option>
          <option value="Lunch">D√©jeuner</option>
          <option value="Dinner">D√Æner</option>
        </select>
      </div>

      <div class="form-group checkbox">
        <label>
          <input 
            type="checkbox" 
            name="isGood" 
            [(ngModel)]="newMeal.isGood"
          />
          <span>C'est un bon repas</span>
        </label>
      </div>

      <div class="form-group">
        <label for="explanation">Explication</label>
        <textarea 
          id="explanation" 
          name="explanation" 
          [(ngModel)]="newMeal.explanation" 
          required
          placeholder="Ex: Bon pour l'√©nergie et l'endurance"
          rows="3"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="emojis">√âmojis</label>
        <input 
          type="text" 
          id="emojis" 
          name="emojis" 
          [(ngModel)]="newMeal.emojis" 
          required
          placeholder="Ex: ü•öü•ñü•Ö"
        />
      </div>

      <div class="form-group">
        <label for="image">Image (optionnelle)</label>
        <div 
          class="image-upload-area"
          [class.drag-over]="isDragOver"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)"
          (click)="imageInput.click()"
        >
          <input
            type="file"
            id="image"
            name="image"
            accept="image/*"
            (change)="onImageSelected($event)"
            #imageInput
          />
          
          <div class="upload-prompt" *ngIf="!newMeal.image">
            <div class="upload-icon">üì∏</div>
            <div class="upload-text">
              <p class="primary">Glissez une image ou cliquez</p>
              <p class="secondary">PNG, JPG, GIF jusqu'√† 5 MB</p>
            </div>
          </div>

          <div class="image-preview-box" *ngIf="newMeal.image">
            <img [src]="newMeal.image" alt="Aper√ßu" class="preview-img" />
            <div class="preview-actions">
              <button type="button" class="btn-remove" (click)="removeImage(); $event.stopPropagation()" title="Retirer l'image">
                ‚úï
              </button>
              <button type="button" class="btn-change" (click)="imageInput.click(); $event.stopPropagation()" title="Changer l'image">
                ‚Üª
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-cancel" (click)="closeAddForm()">
          Annuler
        </button>
        <button type="submit" class="btn btn-add" [disabled]="!mealForm.valid">
          {{ isEditing ? 'Enregistrer' : 'Ajouter' }}
        </button>
      </div>
    </form>
  </div>
</div>

<mat-tab-group animationDuration="0ms"
  [(selectedIndex)]="selectedTabIndex" 
  (selectedIndexChange)="onTabChange($event)"
  class="meals-tabs">
  <mat-tab label="Petit-d√©jeuner">
    <div class="tab-scroll-wrapper">
      <div class="meals-container">
      <div class="meal-card" *ngFor="let meal of filteredMeals; let i = index"
        [class.new]="i === lastAddedIndex"
        [class.removing]="i === removingIndex">
        <div class="card-header">
          <h2>{{ meal.name }}</h2>
          <div class="card-actions">
            <button class="action-btn edit-btn" (click)="openEditForm(meal)" title="Modifier">
              ‚úèÔ∏è
            </button>
            <button class="action-btn delete-btn" (click)="onDelete(meal)" title="Supprimer">
              üóëÔ∏è
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="content-text">
            <div class="info-row">
              <span class="label">Type:</span>
              <span class="value">{{ meal.type }}</span>
            </div>
            <div class="info-row">
              <span class="label">Bon repas:</span>
              <span class="value" [class.good]="meal.isGood" [class.bad]="!meal.isGood">
                {{ meal.isGood ? 'Oui ‚úÖ' : 'Non ‚ùå' }}
              </span>
            </div>
            <div class="info-row">
              <span class="label">Explication:</span>
              <span class="value explanation">{{ meal.explanation }}</span>
            </div>
          </div>
          <div class="image-wrap" *ngIf="meal.image">
            <img class="meal-image" [src]="meal.image" alt="{{ meal.name }}" />
          </div>
        </div>
        <div class="card-footer">
          <div class="emojis">{{ meal.emojis }}</div>
        </div>
      </div>
      </div>
    </div>
  </mat-tab>

  <mat-tab label="D√©jeuner">
    <div class="tab-scroll-wrapper">
      <div class="meals-container">
      <div class="meal-card" *ngFor="let meal of filteredMeals; let i = index"
        [class.new]="i === lastAddedIndex"
        [class.removing]="i === removingIndex">
        <div class="card-header">
          <h2>{{ meal.name }}</h2>
          <div class="card-actions">
            <button class="action-btn edit-btn" (click)="openEditForm(meal)" title="Modifier">
              ‚úèÔ∏è
            </button>
            <button class="action-btn delete-btn" (click)="onDelete(meal)" title="Supprimer">
              üóëÔ∏è
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="content-text">
            <div class="info-row">
              <span class="label">Type:</span>
              <span class="value">{{ meal.type }}</span>
            </div>
            <div class="info-row">
              <span class="label">Bon repas:</span>
              <span class="value" [class.good]="meal.isGood" [class.bad]="!meal.isGood">
                {{ meal.isGood ? 'Oui ‚úÖ' : 'Non ‚ùå' }}
              </span>
            </div>
            <div class="info-row">
              <span class="label">Explication:</span>
              <span class="value explanation">{{ meal.explanation }}</span>
            </div>
          </div>
          <div class="image-wrap" *ngIf="meal.image">
            <img class="meal-image" [src]="meal.image" alt="{{ meal.name }}" />
          </div>
        </div>
        <div class="card-footer">
          <div class="emojis">{{ meal.emojis }}</div>
        </div>
      </div>
      </div>
    </div>
  </mat-tab>

  <mat-tab label="D√Æner">
    <div class="tab-scroll-wrapper">
      <div class="meals-container">
      <div class="meal-card" *ngFor="let meal of filteredMeals; let i = index"
        [class.new]="i === lastAddedIndex"
        [class.removing]="i === removingIndex">
        <div class="card-header">
          <h2>{{ meal.name }}</h2>
          <div class="card-actions">
            <button class="action-btn edit-btn" (click)="openEditForm(meal)" title="Modifier">
              ‚úèÔ∏è
            </button>
            <button class="action-btn delete-btn" (click)="onDelete(meal)" title="Supprimer">
              üóëÔ∏è
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="content-text">
            <div class="info-row">
              <span class="label">Type:</span>
              <span class="value">{{ meal.type }}</span>
            </div>
            <div class="info-row">
              <span class="label">Bon repas:</span>
              <span class="value" [class.good]="meal.isGood" [class.bad]="!meal.isGood">
                {{ meal.isGood ? 'Oui ‚úÖ' : 'Non ‚ùå' }}
              </span>
            </div>
            <div class="info-row">
              <span class="label">Explication:</span>
              <span class="value explanation">{{ meal.explanation }}</span>
            </div>
          </div>
          <div class="image-wrap" *ngIf="meal.image">
            <img class="meal-image" [src]="meal.image" alt="{{ meal.name }}" />
          </div>
        </div>
        <div class="card-footer">
          <div class="emojis">{{ meal.emojis }}</div>
        </div>
      </div>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
